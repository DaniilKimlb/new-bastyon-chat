ResoursesDB=function(e,r,o){var t=this,n=null,c=null,s=31536e3;useapptimeCorrection=function(){if(window.cordova||"undefined"!=typeof _Electron)return!0};let a=()=>{};var i=function(){return Math.floor(Date.now()/1e3)},u=function(e){return l(e).then((e=>{const r=e.openCursor();var o=i();return useapptimeCorrection()&&(o-=s),new Promise(((e,t)=>{r.onsuccess=r=>{const t=r.target.result;t&&(o>=t.value.cachedTo&&(a("PCryptoStorage CLEAR OUTDATED log",r),t.delete()),t.continue()),e()},r.onerror=r=>{a("PCryptoStorage CLEAR OUTDATED error",r),e()}}))}))},l=function(e,r="readwrite"){return t.getdb().then((o=>{try{const t=o.transaction(e,r);t.onsuccess=function(e){a("PCryptoStorage TRANSACTION finished",e)},t.onabort=function(e){a("PCryptoStorage TRANSACTION abort",e.target.error)},t.onerror=function(e){a("PCryptoStorage TRANSACTION error",e.target.error)};const n=t.objectStore(e);return Promise.resolve(n)}catch(e){return console.error(e),Promise.reject(e)}}))};return t.clear=function(e,r){return l(e).then((e=>{const o=e.delete(r);return new Promise(((e,r)=>{o.onsuccess=function(r){a("PCryptoStorage CLEAR log",r),e(!0)},o.onerror=function(e){a("PCryptoStorage CLEAR error",e.target.error),r(e.target.error)}}))}))},t.clearMany=function(e,r){return Promise.all(_.map(r,(r=>t.clear(e,r))))},t.clearAll=function(e){return l(e).then((e=>{const r=e.clear();return new Promise(((e,o)=>{r.onsuccess=function(r){e(!0)},r.onerror=function(e){o(e.target.error)}}))}))},t.get=function(e,r,o){var n=i();return l(e).then((c=>{const a=c.get(r);return new Promise(((e,r)=>{a.onsuccess=function(t){if(a.result)if(a.result.message){if(n>=a.result.cachedTo&&!o){if(!useapptimeCorrection())return void r("delete");if(n-s>=a.result.cachedTo)return void r("delete");if(!o)return void r("Data does not exist")}e({data:a.result.message,date:a.result.date||i()})}else r("Message property does not exist");else r("Data does not exist")},a.onerror=function(e){console.error(e.target.error),r(e.target.error)}})).catch((o=>("delete"==o&&t.clear(e,r),Promise.reject(o))))}))},t.set=function(e,r,o,t){return a("PCryptoStorage writing",o),l(e).then((e=>{const n=i(),c={id:o,message:t,cachedTo:n+r,date:n},s=e.put(c);return new Promise(((e,r)=>{s.onsuccess=function(r){a("PCryptoStorage SET log",r),e(!0)},s.onerror=function(e){a("PCryptoStorage SET error",e.target.error),r(e.target.error)}}))}))},t.getdb=function(){return n?Promise.resolve(n):c||(c=new Promise(((t,c)=>{var s=indexedDB.open(e,r);s.onupgradeneeded=function(e){let r=s.result;const t=e.oldVersion!==e.newVersion,n=0===e.oldVersion;t&&!n&&_.each(r.objectStoreNames,(e=>{r.deleteObjectStore(e)})),_.each(o,(e=>{r.objectStoreNames.contains(e)||r.createObjectStore(e,{keyPath:"id"})}))},s.onblocked=function(e){console.error(e),c("PCryptoStorage error initiating IndexedDB")},s.onerror=function(e){console.error(e),a("PCryptoStorage error occurred:",e),c("PCryptoStorage error initiating IndexedDB")},s.onsuccess=function(){n=s.result,a("PCryptoStorage opened"),_.each(n.objectStoreNames,(e=>{var r,o;r=e,o=rand(15e3,4e4),setTimeout((()=>{n&&n.objectStoreNames.contains(r)&&u(r)}),o)})),t(n),n.onversionchange=function(e){n.close()}}})).finally((()=>{c=null})),c)},t};