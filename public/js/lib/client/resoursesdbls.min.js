ResoursesDB=function(e,r){var t=this,a={name:e,version:r,data:{}},n=function(){return Math.floor(Date.now()/1e3)},o=null;try{localStorage.t=1,o=localStorage}catch(e){o=sessionStorage}if(!o)try{sessionStorage.t=1,o=sessionStorage}catch(e){}var s=null,c=function(){if(s)return s;s=new Promise(((r,t)=>{setTimeout((()=>{try{o[e]=JSON.stringify(a)}catch(e){}r()}),5e3)})).finally((()=>{s=null}))};return t.set=function(e,r,t,o){const s=n();try{const n={id:t,message:JSON.stringify(o),cachedTo:s+r};return a.data[e]||(a.data[e]={}),a.data[e][t]=n,c(),Promise.resolve()}catch(e){return Promise.reject(e)}},t.clear=function(e,r){return a.data[e]&&a.data[e][r]&&(delete a.data[e][r],c()),Promise.resolve()},t.clearAll=function(e){return a.data[e]={},c(),Promise.resolve()},t.clearMany=function(e,r){return Promise.all(r,(r=>t.clear(e,r)))},t.get=function(e,r){var o=n();if(a.data[e]&&a.data[e][r]){var s=a.data[e][r];if(!s.message)return t.clear(e,r),Promise.reject("empty1");if(o>=s.cachedTo)return t.clear(e,r),Promise.reject("delete");try{var c=JSON.parse(s.message);return Promise.resolve(c)}catch(a){return t.clear(e,r),Promise.reject("empty2")}}return Promise.reject("empty3")},t.getdb=function(){try{var s=JSON.parse(o[e]||"{}")}catch(e){}return a.version==s.version&&(a=s),a.data||(a.data={}),a.name!=e&&(a.name=e),a.version!=r&&(a.version=r),_.each(a.data,((e,r)=>{!function(e){const r=n();_.each(a.data[e],((a,n)=>{r>=a.cachedTo&&t.clear(e,n)}))}(r)})),Promise.resolve()},t};