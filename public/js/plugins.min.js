!function(){for(var e,t=function(){},r=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],n=r.length,o=window.console=window.console||{};n--;)o[e=r[n]]||(o[e]=t)}(),function(e){var t=function(e,t){var r=t||{},n=r.bufferLen||4096;this.context=e.context,this.node=this.context.createScriptProcessor(n,2,2);var o=new Worker(r.workerPath||"js/recorderWorker.js");o.postMessage({command:"init",config:{sampleRate:this.context.sampleRate}});var a,c=!1;this.node.onaudioprocess=function(e){c&&o.postMessage({command:"record",buffer:[e.inputBuffer.getChannelData(0),e.inputBuffer.getChannelData(1)]})},this.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(r[t]=e[t])},this.record=function(){c=!0},this.stop=function(){c=!1},this.clear=function(){o.postMessage({command:"clear"})},this.getBuffer=function(e){a=e||r.callback,o.postMessage({command:"getBuffer"})},this.exportWAV=function(e,t){if(a=e||r.callback,t=t||r.type||"audio/wav",!a)throw new Error("Callback not set");o.postMessage({command:"exportWAV",type:t})},this.exportMonoWAV=function(e,t){if(a=e||r.callback,t=t||r.type||"audio/wav",!a)throw new Error("Callback not set");o.postMessage({command:"exportMonoWAV",type:t})},o.onmessage=function(e){var t=e.data;a(t)},e.connect(this.node),this.node.connect(this.context.destination)};t.forceDownload=function(t,r){var n=(e.URL||e.webkitURL).createObjectURL(t),o=e.document.createElement("a");o.href=n,o.download=r||"output.wav";var a=document.createEvent("Event");a.initEvent("click",!0,!0),o.dispatchEvent(a)},e.Recorder=t}(window);var sampleRate,recLength=0,recBuffersL=[],recBuffersR=[];function init(e){sampleRate=e.sampleRate}function record(e){recBuffersL.push(e[0]),recBuffersR.push(e[1]),recLength+=e[0].length}function exportWAV(e){var t=interleave(mergeBuffers(recBuffersL,recLength),mergeBuffers(recBuffersR,recLength)),r=encodeWAV(t),n=new Blob([r],{type:e});this.postMessage(n)}function getBuffer(){var e=[];e.push(mergeBuffers(recBuffersL,recLength)),e.push(mergeBuffers(recBuffersR,recLength)),this.postMessage(e)}function clear(){recLength=0,recBuffersL=[],recBuffersR=[]}function mergeBuffers(e,t){for(var r=new Float32Array(t),n=0,o=0;o<e.length;o++)r.set(e[o],n),n+=e[o].length;return r}function interleave(e,t){for(var r=e.length+t.length,n=new Float32Array(r),o=0,a=0;o<r;)n[o++]=e[a],n[o++]=t[a],a++;return n}function floatTo16BitPCM(e,t,r){for(var n=0;n<r.length;n++,t+=2){var o=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,o<0?32768*o:32767*o,!0)}}this.onmessage=function(e){switch(e.data.command){case"init":init(e.data.config);break;case"record":record(e.data.buffer);break;case"exportWAV":exportWAV(e.data.type);break;case"getBuffer":getBuffer();break;case"clear":clear()}};